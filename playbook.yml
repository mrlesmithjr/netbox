---
- hosts: all
  tasks:
    - name: Include mrlesmithjr.ansible_bootstrap_python
      include_role:
        name: mrlesmithjr.ansible_bootstrap_python
    - name: Include mrlesmithjr.postgresql
      include_role:
        name: mrlesmithjr.postgresql
    - name: Include mrlesmithjr.redis
      include_role:
        name: mrlesmithjr.redis
    - name: Include mrlesmithjr.ansible_netbox
      include_role:
        name: mrlesmithjr.ansible_netbox

- hosts: localhost
  connection: local
  gather_facts: false
  collections:
    - netbox.netbox
  tasks:
    - name: Manage NetBox IPAM Roles
      netbox_ipam_role:
        netbox_url: "{{ netbox_url }}"
        netbox_token: "{{ netbox_token }}"
        data: "{{ item.data }}"
        state: "{{ item.state|default(omit) }}"
      loop: "{{ netbox_ipam_roles }}"

    - name: Manage NetBox Region Parents
      netbox_region:
        netbox_url: "{{ netbox_url }}"
        netbox_token: "{{ netbox_token }}"
        data:
          name: "{{ item.data.parent_region }}"
        state: "{{ item.state|default(omit) }}"
      loop: "{{ netbox_regions }}"
      when: item.data.parent_region is defined

    - name: Manage NetBox Regions
      netbox_region:
        netbox_url: "{{ netbox_url }}"
        netbox_token: "{{ netbox_token }}"
        data: "{{ item.data }}"
        state: "{{ item.state|default(omit) }}"
      loop: "{{ netbox_regions }}"

    - name: Manage NetBox Tenant Groups
      netbox_tenant_group:
        netbox_url: "{{ netbox_url }}"
        netbox_token: "{{ netbox_token }}"
        data: "{{ item.data }}"
        state: "{{ item.state|default(omit) }}"
      loop: "{{ netbox_tenant_groups }}"

    - name: Manage NetBox Tenants
      netbox_tenant:
        netbox_url: "{{ netbox_url }}"
        netbox_token: "{{ netbox_token }}"
        data: "{{ item.data }}"
        state: "{{ item.state|default(omit) }}"
      loop: "{{ netbox_tenants }}"

    - name: Manage NetBox Sites
      netbox_site:
        netbox_url: "{{ netbox_url }}"
        netbox_token: "{{ netbox_token }}"
        data: "{{ item.data }}"
        state: "{{ item.state|default(omit) }}"
      loop: "{{ netbox_sites }}"

    - name: Manage NetBox VRFs
      netbox_vrf:
        netbox_url: "{{ netbox_url }}"
        netbox_token: "{{ netbox_token }}"
        data: "{{ item.data }}"
        state: "{{ item.state|default(omit) }}"
      loop: "{{ netbox_vrfs }}"

    - name: Manage NetBox VLAN Groups
      netbox_vlan_group:
        netbox_url: "{{ netbox_url }}"
        netbox_token: "{{ netbox_token }}"
        data: "{{ item.data }}"
        state: "{{ item.state|default(omit) }}"
      loop: "{{ netbox_vlan_groups }}"

    - name: Manage NetBox VLANs
      netbox_vlan:
        netbox_url: "{{ netbox_url }}"
        netbox_token: "{{ netbox_token }}"
        data: "{{ item.data }}"
        state: "{{ item.state|default(omit) }}"
      loop: "{{ netbox_vlans }}"
